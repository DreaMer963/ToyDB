### 第四章：查询执行

**查询处理器**是DBMS中的一个**部件集合**，它能将用户的查询和数据修改命令转化为数据库上的操作序列并执行这些操作

------

**1. 物理查询计划操作符介绍**

- 物理查询计划由**操作符** 构成，每一个操作符实现计划中的一步。**物理操作符** 常常是一个**关系代数操作符**的特定的实现。

- **扫描表**
  - 在物理查询计划中可以做的最基本的事情是读一个关系R的整个内容。当然也可以仅读出关系R中那些满足这个谓词的元组。定位关系R中元组的基本方法有两种。
    - 很多情况下，**关系R**存放在**二级存储器**的某个区域中，它的元组排放在块中，系统知道包含R的元组块，并且可以一个接一个得到这些块。这个操作叫做**表 - 扫描**。
    - 如果R的任意一个属性上有索引，我们可以使用这个索引来得到R的所有元组，这个操作叫做**索引 - 扫描**。
  - **扫描表时的排序**
    - 在读一个关系的元组时，很多原因促使我们将关系排序。其中一个是查询可能包含**ORDER BY**的子句。或者是**某些算法的要求**。
  - **物理操作符计算模型**
    - 一个查询通常包括几个关系代数操作，相应的物理查询计划由几个物理操作符组成。
  - **衡量代价的参数**
    - 引入用来表达一个操作符代价的参数，例如，我们需要一个参数来表达操作符使用的内存大小，还需要其他参数来衡量它的操作对象的大小
  - **扫描操作符的I/O代价**
  - **实现物理操作符的迭代器**
    - 许多物理操作符可以实现为迭代器。迭代器是三个方法的集合，这三个方法允许**物理操作符结果**的使用者一次一个元组的得到这个结果。
      - **Open()** 这个方法启动获得元组的过程，但是并不获得元组。
      - **GetNext()** 这个方法返回结果中的下一个元组，并且对数据结构做必要的调整得到后续元组。
      - **Close()** 终结迭代



**2. 一趟算法**

- 查询优化中的一个非常重要的问题: 怎样执行逻辑查询计划中的每个单独的步骤，每一个操作符的算法的选择是将逻辑查询计划转变为物理查询计划过程中的一个必不可少的部分。
- 操作符的算法
  - 基于排序的方法
  - 基于散列的方法
  - 基于索引的方法
- 将**操作符算法按照难度和代价分成三种等级**
  - 一些方法仅从磁盘读取一次数据，这就是**一趟算法**
  - 一些方法处理的数据量太大以至于不能装入可利用的内存，但又不是可想象的最大的数据集合。**两趟算法**
  - 某些方法对处理的数据量没有限制，这些方法用三趟或者更多趟来完成。
- 把操作符分为三大类
  - **一次单个元组，一元操作**。
  - **整个关系，一元操作。**
  - **整个关系，二元操作**。
- **一次单个元组操作的一趟算法**
  - 一次读取R的一块到输入缓冲区，对每一个元组进行操作，并将选出的元组或投影得到的元组移至缓冲区。
- **整个关系的一元操作的一趟算法**
  - **消除重复**
    - 为了消除重复，我们可以一次一个的读取R的每一块，但是对于每一个元组，我们需要判定：
      - 这是我们第一次看到的元组，这时将它复制输出
      - 见过的话就不必输出了
    - 